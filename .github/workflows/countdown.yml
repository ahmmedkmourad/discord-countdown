name: Discord Countdown

on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  bot:
    runs-on: ubuntu-latest
    steps:
      - name: Send countdown
        env:
          URL: ${{ secrets.WEBHOOK_URL }}
        run: |
          python3 -c "
import requests, os
from datetime import datetime

webhook = os.getenv('URL')
now = datetime.now()
year = now.year

# Target is April 1st 18:20
target = datetime(year, 4, 1, 18, 20, 0)
if now > target:
    target = datetime(year + 1, 4, 1, 18, 20, 0)

diff = target - now
days = diff.days
hours = diff.seconds // 3600
minutes = (diff.seconds % 3600) // 60

msg = f'''ğŸ“… **DAILY COUNTDOWN**

{days} days, {hours} hours, {minutes} minutes
until April 1st, {target.year} at 18:20'''

data = {'content': msg, 'username': 'Countdown Bot'}
r = requests.post(webhook, json=data)

if r.status_code == 204:
    print('âœ… Sent successfully')
else:
    print(f'âŒ Error: {r.status_code}')
"
