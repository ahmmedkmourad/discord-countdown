name: Discord Countdown
on:
  schedule:
    - cron: '0 9 * * *'
  workflow_dispatch:
jobs:
  discord:
    runs-on: ubuntu-latest
    steps:
    - name: Calculate days
      id: calc
      run: |
        python3 << "EOF"
from datetime import datetime
now = datetime.now()
year = now.year
target = datetime(year, 4, 1, 18, 20, 0)
if now > target:
    target = datetime(year + 1, 4, 1, 18, 20, 0)
days = (target - now).days
hours = (target - now).seconds // 3600
print(f'days={days}')
print(f'hours={hours}')
print(f'year={target.year}')
EOF
    - name: Send to Discord
      env:
        WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        DAYS: ${{ steps.calc.outputs.days }}
        HOURS: ${{ steps.calc.outputs.hours }}
        YEAR: ${{ steps.calc.outputs.year }}
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -d "{\"content\": \"ðŸ“… **Daily Countdown:** $DAYS days, $HOURS hours until April 1st, $YEAR at 18:20\", \"username\": \"Countdown Bot\"}" \
        "$WEBHOOK_URL"
