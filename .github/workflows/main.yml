name: Daily Discord Countdown

on:
  schedule:
    # Runs at 9:00 AM UTC daily
    - cron: '0 9 * * *'
  workflow_dispatch:  # Allows manual trigger

jobs:
  send-countdown:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: pip install requests
    
    - name: Send Discord countdown
      env:
        WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
      run: |
        python -c "
import requests
from datetime import datetime
import os

webhook = os.environ.get('WEBHOOK_URL')
if not webhook:
    print('ERROR: No webhook URL')
    exit(1)

# Calculate countdown
now = datetime.now()
year = now.year
target = datetime(year, 4, 1, 18, 20, 0)
if now > target:
    target = datetime(year + 1, 4, 1, 18, 20, 0)

diff = target - now
days = diff.days
hours = diff.seconds // 3600
minutes = (diff.seconds % 3600) // 60

# Create message
message = f'''ğŸ“… **DAILY COUNTDOWN FROM GITHUB**

â³ **{days} days, {hours} hours, {minutes} minutes**
until **April 1st, {target.year} at 18:20**

_Automatically sent from GitHub Actions_'''

# Send to Discord
data = {
    'content': message,
    'username': 'GitHub Countdown Bot â°',
    'avatar_url': 'https://cdn-icons-png.flaticon.com/512/25/25231.png'
}

try:
    response = requests.post(webhook, json=data)
    if response.status_code == 204:
        print(f'âœ… Success! Sent: {days} days remaining')
    else:
        print(f'âŒ Error: {response.status_code}')
except Exception as e:
    print(f'âŒ Failed: {e}')
        "
