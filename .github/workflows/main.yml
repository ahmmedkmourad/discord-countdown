name: Daily Discord Countdown

on:
  schedule:
    - cron: '0 9 * * *'  # 9 AM UTC daily
  workflow_dispatch:      # Allows manual trigger

jobs:
  send-countdown:
    runs-on: ubuntu-latest
    
    steps:
      - name: Send Discord countdown
        env:
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        run: |
          #!/bin/bash
          
          # Calculate days until April 1st
          current_year=$(date +%Y)
          current_timestamp=$(date +%s)
          target_timestamp=$(date -d "$current_year-04-01 18:20:00" +%s)
          
          # If we passed April 1st, use next year
          if [ $current_timestamp -gt $target_timestamp ]; then
            next_year=$((current_year + 1))
            target_timestamp=$(date -d "$next_year-04-01 18:20:00" +%s)
            target_year=$next_year
          else
            target_year=$current_year
          fi
          
          # Calculate difference
          seconds_left=$((target_timestamp - current_timestamp))
          days=$((seconds_left / 86400))
          hours=$(((seconds_left % 86400) / 3600))
          minutes=$(((seconds_left % 3600) / 60))
          
          # Send to Discord using Python for better string handling
          python3 -c "
import requests
import json
import os

webhook = os.environ.get('WEBHOOK_URL')
days = $days
hours = $hours
minutes = $minutes
target_year = $target_year

message = f'''üìÖ **DAILY COUNTDOWN FROM GITHUB**

‚è≥ **{days} days, {hours} hours, {minutes} minutes**
until **April 1st, {target_year} at 18:20**

_Automatically sent from GitHub Actions_'''

data = {
    'content': message,
    'username': 'Countdown Bot ‚è∞',
    'avatar_url': 'https://cdn-icons-png.flaticon.com/512/3208/3208720.png'
}

try:
    response = requests.post(webhook, json=data)
    if response.status_code == 204:
        print(f'‚úÖ Success! Sent: {days} days remaining')
    else:
        print(f'‚ùå Error: {response.status_code}')
except Exception as e:
    print(f'‚ùå Failed: {e}')
"
